# 初始化集群部署环境

前面几章我们分别完成了yum本地源服务，dns服务以及ntp服务的创建和配置，接下来我们要为集群中的所有主机配置这些基础服务，进一步还要进行安装部署前的环境初始化和检查。

* 禁用防火墙

```
systemctl stop firewalld.service
systemctl disable firewalld.service

setenforce 0  #临时关闭Selinux
sed -i 's/SELINUX=.*/SELINUX=disabled/' /etc/selinux/config  #开机不启动Selinux
```

* 检查UMASK值

UMASK值设置了用户在系统中创建新文件或文件夹时被授予的默权限或基本权限，大数据平台支持的umask值为022/0022和027/0027。集群中的所有主机均要利用umask命令检查或修改umask值。

```
[root@gw ~]# umask  #查询umask值
0022

[root@gw ~]# umask 022   #设置umask值为022
```

* SSH免密登录

在大数据平台部署过程中，为了让Server自动地在所有集群主机上安装Agent，必须在Server主机和其他所有主机之间设置无密码的ssh连接。这样Server主机就能够使用ssh公钥通过身份验证来访问和安装Agent。

在Server主机上生成ssh公钥和私钥。

```
ssh-keygen

[root@server ~]# ls -l ~/.ssh
total 12
-rw-------. 1 root root  409 May  3 02:56 authorized_keys
-rw-------. 1 root root 1679 May 11 08:54 id_rsa       #私钥
-rw-r--r--. 1 root root  408 May 11 08:54 id_rsa.pub   #公钥
```

将生成的ssh公钥复制到其他主机的/root/.ssh目录。

```
scp /root/.ssh/id_rsa.pub root@192.168.70.101:/root/.ssh/
```

在目标主机上将ssh公钥添加到authorized\_keys文件中。

```
cat id_rsa.pub >> authorized_keys
```

然后验证从Server中利用ssh登录目标主机，确保无需输入密码而能够正常登录。

```
ssh root@192.168.70.101
Are you sure you want to continue connecting (yes/no)? #第一登录会询问是否继续
```

* DNS设置和检查

Centos7新增了NetworkManager来提供默认的网络服务，它是一个动态的网络控制和配置守护进程，在/etc/resolv.conf中修改nameserver后，它会定期的恢复成初始值。所以，我们需要禁止NetworkManager定期恢复dns。

```
[root@server ~]# cat /etc/NetworkManager/NetworkManager.conf
[main]
plugins=ifcfg-rh
dns=none               #禁止更新dns

[logging]
#level=DEBUG
#domains=ALL
```

```
#配置dns
cat << eof > /etc/resolv.conf
# Generated by NetworkManager
search bigdata.wh.com
nameserver 192.168.36.149
eof
```

* NTP时间同步



* Yum设置本地仓库

* 优化swap分区设置

* 删除版本冲突的包



